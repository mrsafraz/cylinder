import {Widget} from 'kingdom';
import $ from 'jquery';

class ClampedText extends Widget {
	constructor(){
		this.text = null;
		this.originalText = null;
		this.lines = 1000;
		this.shouldClamp = false;
		this.clamped = false;
		this.view = null;
	}

	reveal(){
		$(this.view).find('.clamped-text').hide();
		$(this.view).find('.original-text').show();
		this.clamped = false;
        window.setTimeout(()=> {
        	$(this.view).find('a').focus();
        }, 100);
	}

	clamp(){
		$(this.view).find('.original-text').hide();
		var $clampElem = $(this.view).find('.clamped-text');
		$clampElem.show();
		var oldContent = $clampElem.text();
        console.log('OLD>>> ', oldContent);
		this.text = this.originalText;
        var clamped = $clamp($clampElem.get(0), {clamp: this.lines, useNativeClamp: false, animate: true});
        this.clamped = true;
        if(this.shouldClamp){
        	return;
        }
        window.setTimeout(()=> {
	        var newContent = $clampElem.text();
	        if(oldContent != newContent){
		        this.shouldClamp = true;
	    	}
	    }, 500);
	}

	showMore(event){

	}

	attached(view){
		this.view = view;
		// this.clamp();
		var lineHeight = $(view).css('line-height');
		lineHeight = parseFloat(('' + lineHeight).replace('px', ''));
		$(view).css({
			height: this.lines * lineHeight,
		})
		// alert($(view).css('line-height'));
	}

	activate(settings){
		this.originalText = settings.text;
		this.text = '' + this.originalText;
		this.lines = settings.lines;
	}
}

export default ClampedText;